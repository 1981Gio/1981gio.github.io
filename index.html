<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiOrders Pro</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="1FFB8DDC-1EC1-4569-971E-598213CC5587.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>

body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  margin:0;
  background:#f2f2f7;
  padding:20px 0;
}

.dark{
  background:#111;
  color:white;
}

.card{
  background:white;
  margin:20px;
  padding:22px;
  border-radius:20px;
  box-shadow:0 6px 20px rgba(0,0,0,.05);
}

.dark .card{
  background:#1c1c1e;
}

h2{
  margin-top:0;
  margin-bottom:18px;
  font-size:22px;
}

input,select{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid #e5e5ea;
  font-size:15px;
  margin-bottom:14px;
  box-sizing:border-box;
}

button{
  padding:10px 14px;
  border:none;
  border-radius:12px;
  font-size:14px;
  cursor:pointer;
  font-weight:500;
}

.primary{
  background:#0A84FF;
  color:white;
}

.red{
  background:#ff3b30;
  color:white;
}

.gray{
  background:#e5e5ea;
}

.buttonRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}

.sizeRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}

.orderBox{
  padding:12px 0;
  border-bottom:1px solid #e5e5ea;
}

.orderTop{
  display:flex;
  justify-content:space-between;
  font-weight:600;
}

.orderBottom{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-top:4px;
}

.statusPaid{color:#34c759;font-weight:600;}
.statusUnpaid{color:#ff3b30;font-weight:600;}

.highlight{
  background:#fff3cd;
  border-radius:10px;
  padding:8px;
}

.pin-screen{
  position:fixed;
  inset:0;
  background:#0A84FF;
  color:white;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}

.keypad{
  display:grid;
  grid-template-columns:repeat(3,70px);
  gap:10px;
}

.keypad button{
  font-size:20px;
  padding:15px;
  background:#004aad;
  color:white;
}

.hidden{display:none;}

@media print{
  button{display:none}
  body{background:white}
}

</style>
</head>

<body>

<div id="pinScreen" class="pin-screen">
<h2>Inserisci PIN</h2>
<div id="pinDisplay" style="font-size:32px;letter-spacing:10px;margin:20px">----</div>
<div class="keypad">
<button onclick="press(1)">1</button>
<button onclick="press(2)">2</button>
<button onclick="press(3)">3</button>
<button onclick="press(4)">4</button>
<button onclick="press(5)">5</button>
<button onclick="press(6)">6</button>
<button onclick="press(7)">7</button>
<button onclick="press(8)">8</button>
<button onclick="press(9)">9</button>
<button onclick="clearPin()">C</button>
<button onclick="press(0)">0</button>
<button onclick="checkPin()">OK</button>
</div>
</div>

<div id="app" class="hidden"></div>

<script>

let data = JSON.parse(localStorage.getItem("gioData") || JSON.stringify({
  settings:{pin:"1926",dark:false},
  events:[]
}));

let currentEvent=null;
let editIndex=null;
let pinInput="";

function save(){
  localStorage.setItem("gioData",JSON.stringify(data));
}

function press(n){
  if(pinInput.length<4){
    pinInput+=n;
    updatePin();
  }
}

function clearPin(){
  pinInput="";
  updatePin();
}

function updatePin(){
  document.getElementById("pinDisplay").innerText=pinInput.padEnd(4,"-");
}

function checkPin(){
 if(pinInput===data.settings.pin){
  document.getElementById("pinScreen").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
  renderHome();
 } else alert("PIN errato");
}

function renderHome(){
document.getElementById("app").innerHTML=`
<div class="card">
<h2>Eventi</h2>

<input id="evName" placeholder="Nome evento">
<select id="evType">
<option>Abbigliamento</option>
<option>Gadget</option>
<option>Bus</option>
</select>
<input id="evPrice" type="number" placeholder="Prezzo â‚¬">
<input id="evSeats" type="number" placeholder="Posti Bus (solo Bus)">

<div class="buttonRow">
  <button class="primary" onclick="addEvent()">Crea evento</button>
  <button class="gray" onclick="toggleDark()">ðŸŒ™ Tema</button>
  <button class="gray" onclick="exportData()">Backup</button>
</div>

<div style="margin-top:12px;">
  <input type="file" onchange="importData(event)">
</div>

</div>

${data.events.map((e,i)=>`
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <div style="font-size:17px;font-weight:600;">
      ${e.name}
    </div>
    <div style="display:flex;gap:8px;">
      <button class="gray" onclick="openEvent(${i})">Apri</button>
      <button class="red" onclick="delEvent(${i})">Elimina</button>
    </div>
  </div>
</div>`).join("")}
`;

if(data.settings.dark)document.body.classList.add("dark");
else document.body.classList.remove("dark");
}

function toggleDark(){
  data.settings.dark=!data.settings.dark;
  save();
  renderHome();
}

function addEvent(){
let name=document.getElementById("evName").value;
if(!name)return;

data.events.push({
 name,
 type:document.getElementById("evType").value,
 price:parseFloat(document.getElementById("evPrice").value||0),
 seats:parseInt(document.getElementById("evSeats").value||0),
 orders:[]
});

save();
renderHome();
}

function delEvent(i){
if(confirm("Eliminare evento?")){
 data.events.splice(i,1);
 save();
 renderHome();
}
}

function exportData(){
let blob=new Blob([JSON.stringify(data)],{type:"application/json"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="giorders_backup.json";
a.click();
}

function importData(e){
let reader=new FileReader();
reader.onload=function(){
 data=JSON.parse(reader.result);
 save();
 renderHome();
};
reader.readAsText(e.target.files[0]);
}

</script>
</body>
</html>