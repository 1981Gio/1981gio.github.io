<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>GiOrders</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="1FFB8DDC-1EC1-4569-971E-598213CC5587.png">

<style>
body { font-family:-apple-system,sans-serif; background:#f2f2f7; padding:15px;}
h1 { text-align:center; color:#0A84FF; }

.card {
  background:white;
  padding:15px;
  border-radius:12px;
  margin-bottom:15px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

.row {
  display:flex;
  gap:8px;
  margin-bottom:8px;
}

.small-select {
  flex:1;
  padding:6px;
  border-radius:6px;
  border:1px solid #ccc;
}

button {
  padding:8px 12px;
  border:none;
  border-radius:8px;
  margin-top:8px;
}

.primary { background:#0A84FF; color:white; }
.red { background:#ff3b30; color:white; }
.green { background:#34c759; color:white; }

.order-line {
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:13px;
  padding:8px 0;
  border-bottom:1px solid #eee;
}

.badge {
  padding:4px 8px;
  border-radius:12px;
  font-size:11px;
  color:white;
}

.badge.green { background:#34c759; }
.badge.red { background:#ff3b30; }

@media print {
  button { display:none; }
  body { background:white; }
}
</style>
</head>

<body>

<h1>GiOrders</h1>

<div class="card">
<h3>Nuovo Ordine</h3>

<input id="cliente" placeholder="Nome Cliente">

<select id="tipoArticolo">
<option value="maglia">T-Shirt</option>
<option value="tazza">Tazza</option>
<option value="zaino">Zaino</option>
<option value="altro">Altro</option>
</select>

<div id="areaTaglie"></div>

<button class="primary" onclick="aggiungiOrdine()">Aggiungi Ordine</button>
</div>

<div class="card">
<h3>Storico Ordini</h3>
<div id="listaOrdini"></div>
</div>

<div class="card">
<h3>Riepilogo Totale Taglie</h3>
<div id="riepilogo"></div>
<button class="primary" onclick="window.print()">Stampa Ordine Completo</button>
</div>

<script>

let ordini = [];
let taglie = ["S","M","L","XL","XXL"];

function creaSelettoriTaglie(){
  let area = document.getElementById("areaTaglie");
  area.innerHTML="";
  
  if(tipoArticolo.value === "maglia"){
    taglie.forEach(t=>{
      area.innerHTML += `
        <div class="row">
          <select class="small-select" id="t_${t}">
            <option value="">${t}</option>
          </select>
          <select class="small-select" id="q_${t}">
            <option value="0">0</option>
            <option>1</option><option>2</option><option>3</option>
            <option>4</option><option>5</option>
          </select>
        </div>
      `;
    });
  } else {
    area.innerHTML = `
      <div class="row">
        <select class="small-select" id="quantitaOggetto">
          <option value="0">Quantità</option>
          <option>1</option><option>2</option><option>3</option>
          <option>4</option><option>5</option>
        </select>
      </div>
    `;
  }
}

tipoArticolo.addEventListener("change", creaSelettoriTaglie);

function aggiungiOrdine(){
  let cliente = cliente.value;
  if(!cliente) return;

  let tipo = tipoArticolo.value;
  let dettagli = {};
  let totaleTaglie = {};

  if(tipo === "maglia"){
    taglie.forEach(t=>{
      let q = parseInt(document.getElementById("q_"+t).value);
      if(q>0){
        dettagli[t]=q;
        totaleTaglie[t]=(totaleTaglie[t]||0)+q;
      }
    });
  } else {
    let q = parseInt(document.getElementById("quantitaOggetto").value);
    if(q>0) dettagli[tipo]=q;
  }

  ordini.push({cliente,tipo,dettagli,pagato:false});
  salva();
  aggiorna();
  document.getElementById("cliente").value="";
}

function aggiorna(){
  let lista = document.getElementById("listaOrdini");
  let riepilogo = {};
  lista.innerHTML="";

  ordini.forEach((o,i)=>{
    let testo = o.cliente+" - "+o.tipo+" ";
    for(let k in o.dettagli){
      testo += o.dettagli[k]+" "+k+" ";
      if(o.tipo==="maglia"){
        riepilogo[k]=(riepilogo[k]||0)+o.dettagli[k];
      }
    }

    lista.innerHTML += `
      <div class="order-line">
        <div>${testo}</div>
        <div>
          <span class="badge ${o.pagato?'green':'red'}">
            ${o.pagato?'PAGATO':'NON PAGATO'}
          </span>
          <button onclick="togglePagato(${i})">↺</button>
          <button class="red" onclick="elimina(${i})">X</button>
        </div>
      </div>
    `;
  });

  let box = document.getElementById("riepilogo");
  box.innerHTML="";
  for(let t in riepilogo){
    box.innerHTML += "<div>Totale "+t+": "+riepilogo[t]+"</div>";
  }
}

function togglePagato(i){
  ordini[i].pagato=!ordini[i].pagato;
  salva();
  aggiorna();
}

function elimina(i){
  ordini.splice(i,1);
  salva();
  aggiorna();
}

function salva(){
  localStorage.setItem("giorders",JSON.stringify(ordini));
}

function carica(){
  let dati = localStorage.getItem("giorders");
  if(dati) ordini=JSON.parse(dati);
  aggiorna();
}

creaSelettoriTaglie();
carica();

</script>

</body>
</html>
