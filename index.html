<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiOrders</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="1FFB8DDC-1EC1-4569-971E-598213CC5587.png">

<style>
:root{
  --bg:#f2f2f7;
  --card:#ffffff;
  --text:#000000;
}
.dark{
  --bg:#1c1c1e;
  --card:#2c2c2e;
  --text:#ffffff;
}
body{
  font-family:-apple-system,sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:16px;
}
h1{text-align:center;color:#0A84FF;}
.card{
  background:var(--card);
  padding:16px;
  border-radius:16px;
  margin-bottom:16px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
}
button{
  padding:8px 12px;
  border:none;
  border-radius:10px;
  font-size:13px;
  margin-top:6px;
}
.primary{background:#0A84FF;color:white;}
.red{background:#ff3b30;color:white;}
.green{background:#34c759;color:white;}
input,select{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  border-radius:10px;
  border:1px solid #ccc;
}
.row{display:flex;gap:8px;}
.badge{
  padding:4px 10px;
  border-radius:20px;
  font-size:11px;
  color:white;
}
.badge.green{background:#34c759;}
.badge.red{background:#ff3b30;}
@media print{button{display:none;}}
</style>
</head>

<body>

<div id="login"></div>
<div id="app" style="display:none;"></div>

<script>

/* ---------- PIN SYSTEM ---------- */

let savedPIN = localStorage.getItem("gi_pin") || "1234";

function renderLogin(){
  login.innerHTML=`
  <div class="card">
    <h3>Accesso GiOrders</h3>
    <input type="password" id="pinInput" placeholder="Inserisci PIN">
    <button class="primary" onclick="checkPIN()">Accedi</button>
  </div>`;
}

function checkPIN(){
  if(pinInput.value===savedPIN){
    login.style.display="none";
    app.style.display="block";
    renderHome();
  }else{
    alert("PIN errato");
  }
}

function cambiaPIN(){
  let nuovo = prompt("Inserisci nuovo PIN (4 cifre)");
  if(nuovo && nuovo.length>=4){
    localStorage.setItem("gi_pin", nuovo);
    savedPIN = nuovo;
    alert("PIN aggiornato");
  }
}

/* ---------- APP ---------- */

let eventi = JSON.parse(localStorage.getItem("gi_eventi")) || {};
let eventoCorrente=null;
let taglie=["XS","S","M","L","XL","XXL"];

function salva(){
  localStorage.setItem("gi_eventi",JSON.stringify(eventi));
}

/* HOME */

function renderHome(){
  let html=`
  <div class="card">
    <button onclick="toggleDark()">üåô Modalit√† Scura</button>
    <button onclick="cambiaPIN()">üîê Cambia PIN</button>
    <h3>Crea Evento</h3>
    <input id="nomeEvento" placeholder="Nome Evento">
    <select id="tipoEvento">
      <option value="maglia">T-Shirt</option>
      <option value="oggetto">Oggetto</option>
    </select>
    <input type="number" id="prezzoEvento" placeholder="Prezzo fisso ‚Ç¨">
    <button class="primary" onclick="creaEvento()">Crea Evento</button>
  </div>

  <div class="card">
    <h3>Eventi</h3>
  `;

  for(let nome in eventi){
    html+=`
    <div class="row">
      <button style="flex:1" onclick="apriEvento('${nome}')">${nome}</button>
      <button class="red" onclick="eliminaEvento('${nome}')">X</button>
    </div>`;
  }

  html+=`</div>`;
  app.innerHTML=html;
}

function creaEvento(){
  let nome=nomeEvento.value;
  let tipo=tipoEvento.value;
  let prezzo=parseFloat(prezzoEvento.value);
  if(!nome||!prezzo)return;

  eventi[nome]={tipo,prezzo,ordini:[]};
  salva();
  renderHome();
}

function eliminaEvento(nome){
  if(confirm("Eliminare evento "+nome+" ?")){
    delete eventi[nome];
    salva();
    renderHome();
  }
}

function apriEvento(nome){
  eventoCorrente=nome;
  renderEvento();
}

/* EVENTO */

function renderEvento(){
  let ev=eventi[eventoCorrente];

  let html=`
  <div class="card">
    <button onclick="renderHome()">‚Üê Torna</button>
    <h3>${eventoCorrente}</h3>
    <p>Prezzo fisso: ‚Ç¨ ${ev.prezzo}</p>
  </div>

  <div class="card">
    <h3>Nuovo Ordine</h3>
    <input id="cliente" placeholder="Nome Cliente">
  `;

  if(ev.tipo==="maglia"){
    taglie.forEach(t=>{
      html+=`
      <div class="row">
        <div style="flex:1">${t}</div>
        <select id="q_${t}" style="flex:1">
          <option value="0">0</option>
          ${[1,2,3,4,5,6,7,8,9].map(n=>`<option>${n}</option>`).join("")}
        </select>
      </div>`;
    });
  }else{
    html+=`
    <select id="q_obj">
      <option value="0">Quantit√†</option>
      ${[1,2,3,4,5,6,7,8,9].map(n=>`<option>${n}</option>`).join("")}
    </select>`;
  }

  html+=`
    <button class="primary" onclick="aggiungiOrdine()">Aggiungi</button>
  </div>

  <div class="card">
    <h3>Storico</h3>
    <div id="listaOrdini"></div>
  </div>`;

  app.innerHTML=html;
  aggiornaEvento();
}

function aggiungiOrdine(){
  let ev=eventi[eventoCorrente];
  let nome=cliente.value;
  if(!nome)return;

  let dettagli={},totale=0;

  if(ev.tipo==="maglia"){
    taglie.forEach(t=>{
      let q=parseInt(document.getElementById("q_"+t).value);
      if(q>0){
        dettagli[t]=q;
        totale+=q*ev.prezzo;
        document.getElementById("q_"+t).value="0";
      }
    });
  }else{
    let q=parseInt(q_obj.value);
    if(q>0){
      dettagli["pezzi"]=q;
      totale+=q*ev.prezzo;
      q_obj.value="0";
    }
  }

  cliente.value="";
  ev.ordini.push({nome,dettagli,totale,pagato:false});
  salva();
  aggiornaEvento();
}

function aggiornaEvento(){
  let ev=eventi[eventoCorrente];
  let lista=document.getElementById("listaOrdini");
  lista.innerHTML="";

  ev.ordini
    .sort((a,b)=>a.nome.localeCompare(b.nome))
    .forEach(o=>{
      lista.innerHTML+=`
      <div class="row">
        <div style="flex:1">${o.nome} - ‚Ç¨ ${o.totale}</div>
        <div>
          <span class="badge ${o.pagato?'green':'red'}">
            ${o.pagato?'PAGATO':'NON PAGATO'}
          </span>
        </div>
      </div>`;
    });
}

/* DARK MODE */

function toggleDark(){
  document.body.classList.toggle("dark");
}

renderLogin();

</script>

</body>
</html>
