<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiOrders</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="1FFB8DDC-1EC1-4569-971E-598213CC5587.png">

<style>
body{
  font-family:-apple-system, BlinkMacSystemFont, sans-serif;
  background:#f2f2f7;
  padding:16px;
}

h1{
  text-align:center;
  color:#0A84FF;
  margin-bottom:5px;
}

.logo{
  display:block;
  margin:0 auto 10px auto;
  width:80px;
}

.card{
  background:white;
  padding:16px;
  border-radius:16px;
  margin-bottom:16px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
}

.card h3{
  margin-top:0;
  font-size:16px;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:10px;
  font-size:13px;
  margin-top:8px;
}

.primary{background:#0A84FF;color:white;}
.red{background:#ff3b30;color:white;}
.green{background:#34c759;color:white;}

input,select{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:10px;
  border:1px solid #d1d1d6;
  font-size:14px;
}

.row{
  display:flex;
  gap:8px;
}

.order-line{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 0;
  border-bottom:1px solid #eee;
  font-size:14px;
}

.badge{
  padding:4px 10px;
  border-radius:20px;
  font-size:11px;
  color:white;
}

.badge.green{background:#34c759;}
.badge.red{background:#ff3b30;}

.summary-box{
  background:#f9f9fb;
  padding:10px;
  border-radius:10px;
  margin-bottom:6px;
  font-size:14px;
}

@media print{
  button{display:none;}
  body{background:white;}
}
</style>
</head>

<body>

<img src="1FFB8DDC-1EC1-4569-971E-598213CC5587.png" class="logo">
<h1>GiOrders</h1>

<div id="home"></div>
<div id="evento" style="display:none;"></div>

<script>

let eventi = JSON.parse(localStorage.getItem("gi_eventi")) || {};
let eventoCorrente = null;
let taglie = ["XS","S","M","L","XL","XXL"];

/* ---------- HOME ---------- */

function renderHome(){
  evento.style.display="none";
  home.style.display="block";

  let html = `
  <div class="card">
    <h3>Crea Nuovo Evento</h3>
    <input id="nomeEvento" placeholder="Nome Evento">
    <select id="tipoEvento">
      <option value="maglia">T-Shirt</option>
      <option value="oggetto">Oggetto</option>
    </select>
    <input type="number" id="prezzoEvento" placeholder="Prezzo fisso €">
    <button class="primary" onclick="creaEvento()">Crea Evento</button>
  </div>

  <div class="card">
    <h3>Eventi Attivi</h3>
  `;

  for(let nome in eventi){
    html += `<button onclick="apriEvento('${nome}')">${nome}</button><br>`;
  }

  html += `</div>`;
  home.innerHTML = html;
}

function creaEvento(){
  let nome = nomeEvento.value;
  let tipo = tipoEvento.value;
  let prezzo = parseFloat(prezzoEvento.value);

  if(!nome || !prezzo) return;

  eventi[nome]={tipo,prezzo,ordini:[]};
  salvaEventi();
  renderHome();
}

function apriEvento(nome){
  eventoCorrente = nome;
  renderEvento();
}

function salvaEventi(){
  localStorage.setItem("gi_eventi",JSON.stringify(eventi));
}

/* ---------- EVENTO ---------- */

function renderEvento(){
  home.style.display="none";
  evento.style.display="block";

  let ev = eventi[eventoCorrente];

  let html=`
  <div class="card">
    <button onclick="renderHome()">← Torna agli Eventi</button>
    <h3>${eventoCorrente}</h3>
    <p><strong>Prezzo fisso:</strong> € ${ev.prezzo}</p>
  </div>

  <div class="card">
    <h3>Nuovo Ordine</h3>
    <input id="cliente" placeholder="Nome Cliente">
  `;

  if(ev.tipo==="maglia"){
    taglie.forEach(t=>{
      html+=`
      <div class="row">
        <select style="flex:1;"><option>${t}</option></select>
        <select id="q_${t}" style="flex:1;">
          <option value="0">0</option>
          ${[1,2,3,4,5,6,7,8,9].map(n=>`<option>${n}</option>`).join("")}
        </select>
      </div>
      `;
    });
  } else {
    html+=`
    <select id="q_obj">
      <option value="0">Quantità</option>
      ${[1,2,3,4,5,6,7,8,9].map(n=>`<option>${n}</option>`).join("")}
    </select>
    `;
  }

  html+=`
    <button class="primary" onclick="aggiungiOrdine()">Aggiungi Ordine</button>
  </div>

  <div class="card">
    <h3>Storico Ordini</h3>
    <div id="listaOrdini"></div>
  </div>

  <div class="card">
    <h3>Riepilogo Evento</h3>
    <div id="riepilogo"></div>
    <button class="primary" onclick="window.print()">Stampa Evento</button>
  </div>
  `;

  evento.innerHTML=html;
  aggiornaEvento();
}

function aggiungiOrdine(){
  let ev=eventi[eventoCorrente];
  let nome=cliente.value;
  if(!nome) return;

  let dettagli={};
  let totale=0;

  if(ev.tipo==="maglia"){
    taglie.forEach(t=>{
      let q=parseInt(document.getElementById("q_"+t).value);
      if(q>0){
        dettagli[t]=q;
        totale+=q*ev.prezzo;
      }
    });
  } else {
    let q=parseInt(q_obj.value);
    if(q>0){
      dettagli["pezzi"]=q;
      totale+=q*ev.prezzo;
    }
  }

  ev.ordini.push({nome,dettagli,totale,pagato:false});
  salvaEventi();
  aggiornaEvento();
}

function aggiornaEvento(){
  let ev=eventi[eventoCorrente];
  let lista=document.getElementById("listaOrdini");
  let riepilogo=document.getElementById("riepilogo");

  lista.innerHTML="";
  let inc=0,nonInc=0;
  let riepilogoTaglie={};

  ev.ordini.forEach((o,i)=>{
    if(o.pagato) inc+=o.totale;
    else nonInc+=o.totale;

    for(let k in o.dettagli){
      if(ev.tipo==="maglia"){
        riepilogoTaglie[k]=(riepilogoTaglie[k]||0)+o.dettagli[k];
      }
    }

    lista.innerHTML+=`
    <div class="order-line">
      <div>${o.nome} - € ${o.totale}</div>
      <div>
        <span class="badge ${o.pagato?'green':'red'}">
          ${o.pagato?'PAGATO':'NON PAGATO'}
        </span>
        <button onclick="toggle(${i})">↺</button>
        <button class="red" onclick="elimina(${i})">X</button>
      </div>
    </div>
    `;
  });

  let htmlR=`
    <div class="summary-box">Totale Incassato: € ${inc}</div>
    <div class="summary-box">Totale Da Incassare: € ${nonInc}</div>
  `;

  if(ev.tipo==="maglia"){
    for(let t in riepilogoTaglie){
      htmlR+=`<div class="summary-box">Totale ${t}: ${riepilogoTaglie[t]}</div>`;
    }
  }

  riepilogo.innerHTML=htmlR;
}

function toggle(i){
  eventi[eventoCorrente].ordini[i].pagato=
  !eventi[eventoCorrente].ordini[i].pagato;
  salvaEventi();
  aggiornaEvento();
}

function elimina(i){
  eventi[eventoCorrente].ordini.splice(i,1);
  salvaEventi();
  aggiornaEvento();
}

renderHome();

</script>

</body>
</html>
