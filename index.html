<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiOrders Pro</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  margin:0;
  background:#f2f2f7;
  padding:20px 0;
}
.dark{background:#111;color:white}
.card{
  background:white;
  margin:20px;
  padding:22px;
  border-radius:20px;
  box-shadow:0 6px 20px rgba(0,0,0,.05);
}
.dark .card{background:#1c1c1e}
h2{margin-top:0;margin-bottom:18px;font-size:22px}
input,select{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid #e5e5ea;
  font-size:15px;
  margin-bottom:14px;
  box-sizing:border-box;
}
button{
  padding:10px 14px;
  border:none;
  border-radius:12px;
  font-size:14px;
  cursor:pointer;
  font-weight:500;
}
.primary{background:#0A84FF;color:white}
.red{background:#ff3b30;color:white}
.gray{background:#e5e5ea}
.buttonRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.sizeRow{display:flex;justify-content:space-between;margin-bottom:8px}
.orderBox{padding:12px 0;border-bottom:1px solid #e5e5ea}
.orderTop{display:flex;justify-content:space-between;font-weight:600}
.orderBottom{display:flex;justify-content:space-between;font-size:14px;margin-top:4px}
.statusPaid{color:#34c759;font-weight:600}
.statusUnpaid{color:#ff3b30;font-weight:600}
.highlight{background:#fff3cd;border-radius:10px;padding:8px}
.hidden{display:none}
</style>
</head>
<body>

<div id="app"></div>

<script>

let data = JSON.parse(localStorage.getItem("gioData") || JSON.stringify({
  settings:{dark:false},
  events:[]
}));

let currentEvent=null;
let editIndex=null;

function save(){
  localStorage.setItem("gioData",JSON.stringify(data));
}

function renderHome(){
document.getElementById("app").innerHTML=`
<div class="card">
<h2>Eventi</h2>

<input id="evName" placeholder="Nome evento">
<select id="evType">
<option>Abbigliamento</option>
<option>Gadget</option>
<option>Bus</option>
</select>
<input id="evPrice" type="number" placeholder="Prezzo â‚¬">
<input id="evSeats" type="number" placeholder="Posti Bus (solo Bus)">

<div class="buttonRow">
  <button class="primary" onclick="addEvent()">Crea evento</button>
  <button class="gray" onclick="toggleDark()">ðŸŒ™ Tema</button>
</div>
</div>

${data.events.map((e,i)=>`
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <div style="font-size:17px;font-weight:600;">${e.name}</div>
    <div style="display:flex;gap:8px;">
      <button class="gray" onclick="openEvent(${i})">Apri</button>
      <button class="red" onclick="delEvent(${i})">Elimina</button>
    </div>
  </div>
</div>`).join("")}
`;

if(data.settings.dark)document.body.classList.add("dark");
else document.body.classList.remove("dark");
}

function toggleDark(){
  data.settings.dark=!data.settings.dark;
  save();
  renderHome();
}

function addEvent(){
let name=document.getElementById("evName").value;
if(!name)return;

data.events.push({
 name,
 type:document.getElementById("evType").value,
 price:parseFloat(document.getElementById("evPrice").value||0),
 seats:parseInt(document.getElementById("evSeats").value||0),
 orders:[]
});

save();
renderHome();
}

function delEvent(i){
if(confirm("Eliminare evento?")){
 data.events.splice(i,1);
 save();
 renderHome();
}
}

function openEvent(i){
currentEvent=i;
let ev=data.events[i];

document.getElementById("app").innerHTML=`
<div class="card">
<h2>${ev.name} - â‚¬${ev.price}</h2>
<input id="custName" placeholder="Nome cliente">
<div id="quantArea"></div>
<label>Pagato</label> <input type="checkbox" id="paid"><br><br>
<button class="primary" onclick="saveOrder()">Salva</button>
<button onclick="renderHome()">Indietro</button>
</div>

<div class="card">
<h3>Ordini</h3>
<div id="orders"></div>
</div>
`;

renderQuantArea();
renderOrders();
}

function renderQuantArea(){
let ev=data.events[currentEvent];
let html="";
if(ev.type==="Abbigliamento"){
["XS","S","M","L","XL","XXL"].forEach(s=>{
 html+=`
 <div class="sizeRow">
  <div>${s}</div>
  <select id="q_${s}">
  ${[...Array(11).keys()].map(n=>`<option>${n}</option>`).join("")}
  </select>
 </div>`;
});
}else{
 html+=`
 <div class="sizeRow">
  <div>QuantitÃ </div>
  <select id="q_Q">
  ${[...Array(51).keys()].map(n=>`<option>${n}</option>`).join("")}
  </select>
 </div>`;
}
document.getElementById("quantArea").innerHTML=html;
}

function saveOrder(){
let ev=data.events[currentEvent];
let name=document.getElementById("custName").value;
if(!name)return;

let sizes={};let totalQty=0;

if(ev.type==="Abbigliamento"){
["XS","S","M","L","XL","XXL"].forEach(s=>{
 let q=parseInt(document.getElementById("q_"+s).value);
 if(q>0){sizes[s]=q;totalQty+=q;}
});
}else{
 let q=parseInt(document.getElementById("q_Q").value);
 if(q>0){sizes["Q"]=q;totalQty+=q;}
}

let order={
 name,
 sizes,
 total:totalQty*ev.price,
 paid:document.getElementById("paid").checked
};

ev.orders.push(order);

save();
document.getElementById("custName").value="";
document.getElementById("paid").checked=false;
renderQuantArea();
renderOrders();
}

function renderOrders(){
let ev=data.events[currentEvent];
let container=document.getElementById("orders");
container.innerHTML="";

ev.orders.forEach(o=>{
container.innerHTML+=`
<div class="orderBox">
<div class="orderTop">
 <div>${o.name}</div>
 <div>â‚¬ ${o.total}</div>
</div>
<div class="orderBottom">
 <div>${Object.entries(o.sizes).map(([k,v])=>v+" "+k).join(" - ")}</div>
 <div class="${o.paid?'statusPaid':'statusUnpaid'}">${o.paid?'PAGATO':'NON PAGATO'}</div>
</div>
</div>`;
});
}

renderHome();

</script>
</body>
</html>
